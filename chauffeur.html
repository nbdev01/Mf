<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Espace Chauffeur</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>Espace Chauffeur (démo sans mot de passe)</h1>

  <div id="zone-login">
    <input type="text" id="identifiant" placeholder="Identifiant (ex: jean.d.transvern)">
    <button onclick="connexion()">Entrer</button>
  </div>

  <div id="zone-frais" class="hidden">
    <h2 id="nomChauffeur"></h2>

    <label for="dateSelect">Choisir un jour :</label>
    <select id="dateSelect" onchange="changerJour()"></select>

    <table>
      <thead>
        <tr>
          <th>Petit-déj</th>
          <th>Déjeuner</th>
          <th>Dîner</th>
          <th>Nuitée</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><select id="Petit-déj"><option value=""></option><option value="X">X</option><option value="i">i</option></select></td>
          <td><select id="Déjeuner"><option value=""></option><option value="X">X</option><option value="i">i</option></select></td>
          <td><select id="Dîner"><option value=""></option><option value="X">X</option><option value="i">i</option></select></td>
          <td><select id="Nuitée"><option value=""></option><option value="X">X</option><option value="i">i</option></select></td>
        </tr>
      </tbody>
    </table>

    <button onclick="enregistrer()">Enregistrer</button>
  </div>

  <script>
    const types = ['Petit-déj', 'Déjeuner', 'Dîner', 'Nuitée'];
    let identifiant = "";
    let dateDuJour = "";

    function formatDate(d) {
      const jour = String(d.getDate()).padStart(2, '0');
      const mois = String(d.getMonth() + 1).padStart(2, '0');
      const an = d.getFullYear();
      return `${jour}-${mois}-${an}`;
    }

    function connexion() {
      identifiant = document.getElementById('identifiant').value.trim().toLowerCase();
      if (!identifiant) {
        alert("Merci de renseigner un identifiant.");
        return;
      }
      sessionStorage.setItem('chauffeurActif', identifiant);
      document.getElementById('zone-login').classList.add('hidden');
      document.getElementById('zone-frais').classList.remove('hidden');
      document.getElementById('nomChauffeur').textContent = `Chauffeur : ${identifiant}`;
      chargerDates();
    }

    function chargerDates() {
      const select = document.getElementById('dateSelect');
      select.innerHTML = '';
      const maintenant = new Date();
      const an = maintenant.getFullYear();
      const mois = maintenant.getMonth();
      const aujourdHui = formatDate(maintenant);
      dateDuJour = aujourdHui;

      const premier = new Date(an, mois, 1);
      const dernierJour = new Date(an, mois + 1, 0).getDate();

      for (let i = 1; i <= dernierJour; i++) {
        const d = new Date(an, mois, i);
        const f = formatDate(d);
        const opt = document.createElement('option');
        opt.value = f;
        opt.textContent = f;
        if (f === aujourdHui) opt.selected = true;
        select.appendChild(opt);
      }

      afficherFrais(aujourdHui);
    }

    function changerJour() {
      const dateChoisie = document.getElementById('dateSelect').value;
      afficherFrais(dateChoisie);
    }

    function afficherFrais(date) {
      dateDuJour = date;
      const key = `frais-${identifiant}-${date}`;
      const data = JSON.parse(localStorage.getItem(key));
      types.forEach(type => {
        document.getElementById(type).value = data ? data[type] : "";
      });
    }

    function enregistrer() {
      const key = `frais-${identifiant}-${dateDuJour}`;
      const data = {};
      types.forEach(type => {
        data[type] = document.getElementById(type).value;
      });
      localStorage.setItem(key, JSON.stringify(data));
      alert("Fiche enregistrée !");
    }

    const actif = sessionStorage.getItem('chauffeurActif');
    if (actif) {
      identifiant = actif;
      document.getElementById('zone-login').classList.add('hidden');
      document.getElementById('zone-frais').classList.remove('hidden');
      document.getElementById('nomChauffeur').textContent = `Chauffeur : ${identifiant}`;
      chargerDates();
    }
  </script>

</body>
</html>
